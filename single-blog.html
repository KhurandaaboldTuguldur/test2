<!-- âœ… í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
  const slug = new URLSearchParams(window.location.search).get("slug");
  const wrapper = document.getElementById("post-wrapper");
  const yearEl = document.getElementById("year") || document.getElementById("copyrightYear");
  if (yearEl) yearEl.innerText = new Date().getFullYear();

  function showError(msg) {
    wrapper.innerHTML = `<p style="color:red">${msg} <a href="index.html">â† í™ˆìœ¼ë¡œ</a></p>`;
  }

  function formatDate(dateStr) {
    try {
      return new Date(dateStr).toLocaleDateString("ko-KR", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit"
      });
    } catch {
      return dateStr;
    }
  }

  function parseFrontmatter(md) {
    const match = md.match(/^---\s*([\s\S]*?)\s*---\s*([\s\S]*)$/);
    if (!match) return { data: {}, content: md };

    const raw = match[1];
    const content = match[2];
    const data = {};
    raw.split('\n').forEach(line => {
      const [key, ...rest] = line.split(':');
      if (key && rest.length > 0) {
        data[key.trim()] = rest.join(':').trim();
      }
    });
    return { data, content };
  }

  function renderPost(md) {
    if (typeof marked !== "function") {
      showError("â— marked ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      return;
    }

    const parsed = parseFrontmatter(md); // âœ… ëŒ€ì²´ëœ parser
    const fm = parsed.data;
    const html = marked.parse(parsed.content);

    const rawThumb = (fm.thumbnail || "").replace(/^\/+|\/+$/g, "");
    const thumbnail = rawThumb.startsWith("http") ? rawThumb : "/" + rawThumb;

    wrapper.innerHTML = `
      <article class="blog-post">
        <h1>${fm.title || slug}</h1>
        ${fm.date ? `<p><em>${formatDate(fm.date)}</em></p>` : ""}
        ${fm.thumbnail ? `<img src="${thumbnail}" alt="ì¸ë„¤ì¼" style="max-width:100%;margin:1rem 0;border-radius:8px;" />` : ""}
        <div class="post-content">${html}</div>
      </article>
    `;
  }

  function fetchPost(slug) {
    fetch(`./posts/${slug}.md`)
      .then(res => {
        if (!res.ok) throw new Error("â— í¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return res.text();
      })
      .then(renderPost)
      .catch(err => {
        console.error("âš ï¸", err);
        showError("ğŸš« í•´ë‹¹ í¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”.");
      });
  }

  if (!slug) {
    showError("â— URLì— slug íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  } else {
    fetchPost(slug);
  }
</script>
